<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Registro de Abastecimentos</h1>
      <p class="subtitle">Controle de vendas e fluxo de caixa</p>
    </div>
    <button mat-flat-button color="primary" (click)="openDialog()">
      <mat-icon>add</mat-icon>
      Novo Registro
    </button>
  </div>

  <mat-card class="table-card">
    @if (dataSource.data.length === 0) {
    <div class="empty-state">
      <mat-icon>receipt_long</mat-icon>
      <p>Nenhum abastecimento registrado hoje.</p>
    </div>
    } @else {
    <table mat-table [dataSource]="dataSource" class="hub-table">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef class="w-80">ID</th>
        <td mat-cell *matCellDef="let e">
          <span class="transaction-id">#{{ e.id }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="data">
        <th mat-header-cell *matHeaderCellDef>Data/Hora</th>
        <td mat-cell *matCellDef="let e">
          <div class="date-col">
            <mat-icon class="tiny-icon">calendar_today</mat-icon>
            <span class="date-text">{{ e.dataAbastecimento | date : 'dd/MM/yyyy' }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="bomba">
        <th mat-header-cell *matHeaderCellDef>Origem</th>
        <td mat-cell *matCellDef="let e">
          <span class="pump-badge">{{ e.bombaCombustivel?.nome || 'N/A' }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="litros">
        <th mat-header-cell *matHeaderCellDef>Volume</th>
        <td mat-cell *matCellDef="let e">
          <strong>{{ e.litragem }} L</strong>
        </td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef>Valor Total</th>
        <td mat-cell *matCellDef="let e">
          <span class="price-tag">
            {{ e.valorTotal | currency : 'BRL' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let e">
          <span
            class="status-badge"
            [class.success]="e.status !== 'CANCELADO'"
            [class.cancelled]="e.status === 'CANCELADO'"
          >
            {{ e.status || 'CONCLUÍDO' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="col-actions">Ações</th>
        <td mat-cell *matCellDef="let e" class="col-actions">
          @if (e.status !== 'CANCELADO') {
          <button
            class="soft-btn warn-btn"
            (click)="cancelItem(e.id)"
            matTooltip="Cancelar Fiscalmente (Estornar)"
          >
            <mat-icon>block</mat-icon>
          </button>
          } @else {
          <span class="locked-icon" matTooltip="Registro Bloqueado">
            <mat-icon>lock</mat-icon>
          </span>
          }
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="hover-row"
        [class.row-cancelled]="row.status === 'CANCELADO'"
      ></tr>
    </table>
    }
  </mat-card>
</div>
