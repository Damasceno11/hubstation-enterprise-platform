# ===================================================================
# CONFIGURAÇÃO DO SERVIDOR
# ===================================================================
server:
  port: 8080

spring:
  application:
    name: sistema-posto-api

  # ===================================================================
  # BANCO DE DADOS (PostgreSQL)
  # ===================================================================
  datasource:
    # Usa o nome do container 'postgres-db' definido no docker-compose
    url: jdbc:postgresql://postgres-db:5432/hubstation_db
    username: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  # ===================================================================
  # FLYWAY (Migrações de Banco)
  # ===================================================================
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  # ===================================================================
  # JPA / HIBERNATE
  # ===================================================================
  jpa:
    open-in-view: false
    show-sql: true

    hibernate:
      ddl-auto: validate # O Flyway cria as tabelas, o Hibernate apenas confere

    properties:
      hibernate:
        format_sql: true
        default_schema: public
        # REMOVIDO: 'dialect' (O Hibernate detecta automaticamente e evita warnings)

        # Configuração de Sequence (Otimização)
        id:
          new_generator_mappings: true
          enhanced:
            optimizer: pooled-lo
            increment_size: 50

  # ===================================================================
  # RABBITMQ (Mensageria)
  # ===================================================================
  rabbitmq:
    host: ${SPRING_RABBITMQ_HOST:rabbitmq}
    port: ${SPRING_RABBITMQ_PORT:5672}
    username: ${SPRING_RABBITMQ_USERNAME:guest}
    password: ${SPRING_RABBITMQ_PASSWORD:guest}

# ===================================================================
# OBSERVABILIDADE (CRUCIAL PARA DEBUG)
# ===================================================================
management:
  endpoints:
    web:
      exposure:
        include: health, info, metrics
  endpoint:
    health:
      show-details: always # ISSO VAI MOSTRAR O ERRO REAL NO NAVEGADOR
      probes:
        enabled: true
  health:
    rabbit:
      enabled: false # Impede que o Health Check falhe se o Rabbit demorar a subir
